const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DXxutvoB.js","./CfH4ePFN.js","./DJAyu_pX.js","./entry.DHJIpuq3.css","./4t6uwcST.js","./DXJZGQ7R.js","./DoHyfDZ5.js"])))=>i.map(i=>d[i]);
import{a as X,_ as Y,b as Z}from"./DCnH7YXP.js";import{aj as ee,e as P,A as G,C as te,N as oe,x as K,h as O,o as b,i as z,w as l,b as i,j as s,k,c as T,m as S,a as C,t as B,V as H,W as se,d as J,n as y,az as ae,p as W,q as re,r as ne,aw as x,ay as ie}from"./DJAyu_pX.js";import{u as N,_ as le}from"./DeRnuWMo.js";import{u as de}from"./CFg0U6eW.js";import{z as M,_ as ce,a as ue,b as me}from"./DoHyfDZ5.js";import{a as pe,_ as fe}from"./DXJZGQ7R.js";import{_ as ve}from"./DlAUqK2U.js";import"./4t6uwcST.js";const _e=()=>ee("target-drivers","/target-drivers"),ge=re(()=>ne(()=>import("./DXxutvoB.js"),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url).then(p=>p.default||p)),be=["innerHTML"],ye=["textContent"],Ce={class:"list-disc list-outside ml-4"},ke=["textContent"],he=P({__name:"Target",props:G({mode:{default:"create"},target:{}},{open:{type:Boolean},openModifiers:{}}),emits:G(["created","updated"],["update:open"]),setup(p,{emit:h}){const _=te(p,"open"),c=h,w=oe(),{data:g}=_e(),D=K({driver:null,config:{}}),u=O(()=>p.target||D),V=O(()=>{const a=Object.keys(g.value||{});return M.object({driver:a.length>0?M.enum([a[0],...a.slice(1)],{required_error:"Driver is required"}):M.string({required_error:"Driver is required"})})}),q=async()=>{var a,d,n,e;if(p.mode==="create"){const{status:t,error:o,data:r}=await N("/targets",{method:"post",body:u,watch:!1});if(t.value==="success"){const f=r.value;y().add({title:"Success",color:"success",description:f.message}),c("created")}else t.value==="error"&&y().add({title:"Error",description:((d=(a=o.value)==null?void 0:a.data)==null?void 0:d.error)||((n=o.value)==null?void 0:n.message),color:"red"})}else if(p.mode==="edit"){const{status:t,error:o,data:r}=await N(`/targets/${p.target.id}`,{method:"put",body:u,watch:!1});if(t.value==="success"){const f=r.value;y().add({title:"Success",color:"success",description:f.message}),c("updated")}else t.value==="error"&&y().add({title:"Error",description:(e=o.value)==null?void 0:e.message,color:"error"})}_.value=!1},j=async()=>{var e,t,o;if(await((e=w.value)==null?void 0:e.validate(void 0,{silent:!0}))===!1)return;const{status:a,error:d,data:n}=await N("/target-drivers/test",{method:"post",body:u,watch:!1});if(a.value==="success"){const r=n.value;y().add({title:"Success",color:"success",description:r.message});return}if(a.value==="error"&&[400,422,500].includes(((t=d.value)==null?void 0:t.statusCode)||0)){const r=(o=d.value)==null?void 0:o.data;y().add({title:"Error",description:r==null?void 0:r.error,color:"error"})}};return(a,d)=>{var m,$;const n=ce,e=pe,t=ue,o=ae,r=ge,f=fe,U=W,L=me;return b(),z(L,{title:{create:"New target",edit:`Edit target n°${(m=a.target)==null?void 0:m.id}`,read:`Target n° ${($=a.target)==null?void 0:$.id}`}[a.mode],description:"Configure data target",open:_.value,"onUpdate:open":d[1]||(d[1]=F=>_.value=F)},{body:l(()=>[i(f,{class:"space-y-4",state:s(u),schema:s(V),onSubmit:k(q,["prevent"]),ref_key:"formEl",ref:w,disabled:a.mode==="read",id:"targetForm"},{default:l(()=>{var F,A,I,R;return[i(e,{name:"driver",label:"Driver",required:""},{default:l(()=>[i(n,{options:Object.entries(s(g)||{}).map(([v,Q])=>({value:v,item:Q})),modelValue:s(u).driver,"onUpdate:modelValue":d[0]||(d[0]=v=>s(u).driver=v)},{default:l(({item:v})=>[v.config.image?(b(),T("span",{key:0,innerHTML:v.config.image,class:"nested-svg"},null,8,be)):S("",!0),C("span",{textContent:B(v.config.name)},null,8,ye)]),_:1},8,["options","modelValue"])]),_:1}),s(g)&&s(u).driver?(b(),T(H,{key:0},[(((R=(I=(A=(F=s(g))==null?void 0:F[s(u).driver])==null?void 0:A.config)==null?void 0:I.notes)==null?void 0:R.length)||0)>0?(b(),z(o,{key:0},{content:l(()=>[C("ul",Ce,[(b(!0),T(H,null,se(s(g)[s(u).driver].config.notes,v=>(b(),T("li",{textContent:B(v)},null,8,ke))),256))])]),default:l(()=>[i(t,{label:"Driver Notes"})]),_:1})):S("",!0),i(o,null,{default:l(()=>[i(t,{label:"Driver Configuration"}),i(r,{state:s(u).config,disabled:a.mode==="read",fields:s(g)[s(u).driver].fields},null,8,["state","disabled","fields"])]),_:1})],64)):S("",!0)]}),_:1},8,["state","schema","disabled"])]),footer:l(()=>[i(U,{type:"button",onClick:k(j,["prevent"]),variant:"soft",color:"secondary"},{default:l(()=>d[2]||(d[2]=[J(" Test configuration ")])),_:1}),a.mode!=="read"?(b(),z(U,{key:0,type:"submit",class:"ml-auto",form:"targetForm"},{default:l(()=>[J(B({create:"Create",edit:"Save changes"}[a.mode]),1)]),_:1})):S("",!0)]),_:1},8,["title","open"])}}}),E=ve(he,[["__scopeId","data-v-cd113215"]]),$e={class:"flex space-x-4"},xe={class:"flex gap-2 justify-end"},Be=P({__name:"targets",setup(p){var d;const{status:h,data:_,refresh:c}=de(),w=(d=x())==null?void 0:d.isOpen,g=[{key:"id",label:"#",sortable:!0},{key:"excerpt",label:"Excerpt",sortable:!0},{key:"driver",label:"Driver",sortable:!0},{key:"actions"}],D=O(()=>{var n;return((n=_.value)==null?void 0:n.map(e=>({id:e.id,excerpt:e.excerpt,driver:e.driver})))||[]}),u=()=>{x().open(E,{mode:"create",onCreated:()=>c(),onUpdated:()=>c()})},V=n=>{var t;const e=(t=_.value)==null?void 0:t.find(o=>o.id===n);x().open(E,{mode:"read",target:e,onCreated:()=>c(),onUpdated:()=>c()})},q=n=>{var t;const e=(t=_.value)==null?void 0:t.find(o=>o.id===n);x().open(E,{mode:"edit",target:e,onCreated:()=>c(),onUpdated:()=>c()})},j=n=>{var t;const e=(t=_.value)==null?void 0:t.find(o=>o.id===n);x().open(E,{mode:"create",target:K({...JSON.parse(JSON.stringify(e))}),onCreated:()=>c(),onUpdated:()=>c()})},a=async n=>{var r;const{data:e,error:t,status:o}=await N(`/targets/${n}`,{method:"DELETE"});if(o.value==="error")y().add({color:"error",title:"Unable to delete target",description:(r=t.value)==null?void 0:r.message});else if(o.value==="success"){const f=e.value;y().add({color:"success",title:"Successfully deleted target",description:f.message})}await c()};return(n,e)=>{const t=X,o=ie,r=W,f=Y,U=Z,L=le;return b(),z(L,{as:"section",id:"targets",ui:{body:"p-0 sm:p-0",header:"flex gap-x-2 justify-between items-center",footer:"text-sm leading-5 text-center"}},{header:l(()=>[e[3]||(e[3]=C("h1",null,"Targets",-1)),C("div",$e,[i(t,{kbds:["r"],label:"Refresh",color:"info",variant:"soft",icon:"i-heroicons-arrow-path-20-solid",onClick:e[0]||(e[0]=()=>s(c)()),loading:s(h)==="pending"||s(h)==="idle"},null,8,["loading"]),i(t,{kbds:["c"],label:"Create",variant:"soft","leading-icon":"i-heroicons-plus",disabled:s(w),onClick:e[1]||(e[1]=()=>u())},null,8,["disabled"])])]),footer:l(()=>{var m;return[e[4]||(e[4]=C("span",{class:"font-medium"},"Total: ",-1)),C("span",null,B(((m=s(D))==null?void 0:m.length)||0)+" targets",1)]}),default:l(()=>[i(U,{columns:g,rows:s(D),loading:["idle","pending"].includes(s(h)),sorting:[{desc:!0,id:"id"}]},{"cell-driver":l(({row:m})=>[i(o,{size:"sm",label:m.driver,color:"secondary",variant:"subtle"},null,8,["label"])]),"cell-actions":l(({row:m})=>[C("div",xe,[i(f,{items:[[{label:"Replicate",onSelect:()=>j(m.id)}]],onClick:e[2]||(e[2]=k(()=>{},["stop"]))},{default:l(()=>[i(r,{icon:"i-heroicons-ellipsis-horizontal",variant:"link",color:"neutral",class:"p-0",size:"xl"})]),_:2},1032,["items"]),i(r,{icon:"i-heroicons-eye",variant:"link",color:"neutral",size:"xl",onClick:k($=>V(m.id),["stop","prevent"]),class:"p-0"},null,8,["onClick"]),i(r,{icon:"i-heroicons-pencil-square",variant:"link",color:"neutral",size:"xl",onClick:k($=>q(m.id),["stop","prevent"]),class:"p-0"},null,8,["onClick"]),i(r,{icon:"i-heroicons-trash",variant:"link",color:"error",size:"xl",onClick:k($=>a(m.id),["stop","prevent"]),class:"p-0"},null,8,["onClick"])])]),_:1},8,["rows","loading"])]),_:1})}}});export{Be as default};
