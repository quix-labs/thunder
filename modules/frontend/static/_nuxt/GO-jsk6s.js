const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jAUyqqt4.js","./CSDh5bKg.js","./CmCqKDSp.js","./entry.DHJIpuq3.css","./D3nfvcBV.js","./EBrLb2w8.js","./CzVMdW3V.js"])))=>i.map(i=>d[i]);
import{_ as I,a as L,b as N}from"./B7Dajo9s.js";import{q as P,r as F,e as O,g as R,aw as U,h as V,o as _,i as k,w as i,a as d,b as n,j as a,t as j,c as M,W as q,V as A,k as v,p as m,ax as G,n as u,ay as K}from"./CmCqKDSp.js";import{_ as W,u as $}from"./CzVMdW3V.js";import"./D3nfvcBV.js";const H=P(()=>F(()=>import("./jAUyqqt4.js"),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url).then(g=>g.default||g.default||g)),J={class:"flex space-x-4"},Q={class:"flex gap-1"},X={class:"flex gap-1"},Y={class:"flex gap-1"},Z={class:"flex gap-2 justify-end"},ne=O({__name:"index",setup(g){var y;const{status:b,data:C,refresh:f}=R(),S=(y=U())==null?void 0:y.isOpen,z=[{key:"id",label:"#",sortable:!0,rowClass:"w-[1px] whitespace-nowrap"},{key:"source",label:"Source",sortable:!0},{key:"index",label:"Index",sortable:!0},{key:"targets",label:"Targets",sortable:!0},{key:"stats",label:"Stats",sortable:!1},{key:"listening",label:"Listening",sortable:!0},{key:"indexing",label:"Indexing",sortable:!0},{key:"actions",sortable:!1,rowClass:"w-[1px] whitespace-nowrap"}],x=V(()=>{var l;return((l=C.value)==null?void 0:l.map(s=>{var o;return{id:s.id,targets:s.targets,index:s.index||"---",source:s.source!==void 0?s.source:"---",stats:{conditions:((o=s.conditions)==null?void 0:o.length)||0,...h(s.mapping||[])},indexing:s.indexing||!1,listening:s.listening||!1}}))||[]}),h=l=>{const s=l.filter(t=>t._type==="relation"),o={total:l.length,relations:s.length};return l.filter(t=>t._type==="relation").forEach(t=>{const{total:r,relations:c}=h(t.mapping||[]);o.total+=r,o.relations+=c}),o},w=l=>{G().open(H,{processorId:l})},T=async l=>{var r;const{data:s,error:o,status:t}=await $(`/processors/${l}`,{method:"DELETE"});if(t.value==="error")u().add({color:"error",title:"Unable to delete processor",description:(r=o.value)==null?void 0:r.message});else if(t.value==="success"){const c=s.value;u().add({color:"success",title:"Successfully deleted processor",description:c.message}),await f()}},D=l=>{$(`/processors/${l}/index`,{method:"POST"}).then(({data:s,error:o,status:t})=>{var r,c,e;if(t.value==="error")u().add({color:"error",title:"Unable to indexing",description:((c=(r=o.value)==null?void 0:r.data)==null?void 0:c.error)||((e=o.value)==null?void 0:e.message)});else if(t.value==="success"){const p=s.value;u().add({color:"success",title:"Successfully indexed",description:p.message}),f()}})},E=l=>{u().add({color:"error",title:"Not implemented yet!",description:"Currently working on!"})},B=l=>{u().add({color:"error",title:"Not implemented yet!",description:"Currently working on!"})};return(l,s)=>{const o=L,t=K,r=N,c=W;return _(),k(c,{as:"section",id:"processors",ui:{body:"p-0 sm:p-0",header:"flex gap-x-2 justify-between items-center",footer:"text-sm leading-5 text-center"}},{header:i(()=>[s[2]||(s[2]=d("h1",null,"Processors",-1)),d("div",J,[n(o,{kbds:["r"],label:"Refresh",color:"info",variant:"soft",icon:"i-heroicons-arrow-path-20-solid",onClick:s[0]||(s[0]=()=>a(f)()),loading:a(b)==="pending"||a(b)==="idle"},null,8,["loading"]),n(o,{kbds:["c"],label:"Create",variant:"soft","leading-icon":"i-heroicons-plus",disabled:a(S),to:"/processors/create"},null,8,["disabled"])])]),footer:i(()=>{var e;return[s[3]||(s[3]=d("span",{class:"font-medium"},"Total: ",-1)),d("span",null,j(((e=a(x))==null?void 0:e.length)||0)+" processors",1)]}),default:i(()=>[n(r,{columns:z,rows:a(x),loading:["idle","pending"].includes(a(b)),sorting:[{desc:!0,id:"id"}]},{"cell-source":i(({row:e})=>[d("div",Q,[n(t,{size:"sm",label:`Source n°${e.source}`,color:"secondary",variant:"subtle"},null,8,["label"])])]),"cell-targets":i(({row:e})=>[d("div",X,[(_(!0),M(A,null,q(e.targets,p=>(_(),k(t,{size:"sm",label:`Target n°${p}`,color:"secondary",variant:"subtle"},null,8,["label"]))),256))])]),"cell-stats":i(({row:e})=>[d("div",Y,[n(t,{size:"sm",label:`${e.stats.total} fields`,color:"neutral",variant:"subtle"},null,8,["label"]),n(t,{size:"sm",label:`${e.stats.relations} relations`,color:"neutral",variant:"subtle"},null,8,["label"]),n(t,{size:"sm",label:`${e.stats.conditions} conditions`,color:"neutral",variant:"subtle"},null,8,["label"])])]),"cell-indexing":i(({row:e})=>[n(t,{label:e.indexing?"Indexing":"Not indexing",color:e.indexing?"success":"error",variant:"subtle",size:"sm"},null,8,["label","color"])]),"cell-listening":i(({row:e})=>[n(t,{label:e.listening?"Listening":"Not listening",color:e.listening?"success":"error",variant:"subtle",size:"sm"},null,8,["label","color"])]),"cell-actions":i(({row:e})=>[d("div",Z,[n(a(I),{items:[[{label:"Replicate",to:`/processors/create?from=${e.id}`},{label:"Claim indexing",onSelect:()=>D(e.id),disabled:e.indexing},{label:"Start listening",onSelect:()=>E(e.id),disabled:e.listening},{label:"Stop listening",onSelect:()=>B(e.id),disabled:!e.listening}]],onClick:s[1]||(s[1]=v(()=>{},["stop"]))},{default:i(()=>[n(a(m),{icon:"i-heroicons-ellipsis-horizontal",variant:"link",color:"neutral",class:"p-0",size:"xl"})]),_:2},1032,["items"]),n(a(m),{icon:"i-heroicons-eye",variant:"link",color:"neutral",class:"p-0",size:"xl",to:`/processors/${e.id}`},null,8,["to"]),n(a(m),{icon:"i-heroicons-pencil-square",variant:"link",color:"neutral",class:"p-0",size:"xl",to:`/processors/${e.id}/edit`},null,8,["to"]),n(a(m),{icon:"i-heroicons-document-arrow-down",variant:"link",color:"primary",class:"p-0",size:"xl",onClick:v(p=>w(e.id),["stop","prevent"])},null,8,["onClick"]),n(a(m),{icon:"i-heroicons-trash",variant:"link",color:"error",class:"p-0",size:"xl",onClick:v(p=>T(e.id),["stop","prevent"])},null,8,["onClick"])])]),_:1},8,["rows","loading"])]),_:1})}}});export{ne as default};
