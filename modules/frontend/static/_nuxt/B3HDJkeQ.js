const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CqY6xSgL.js","./DDeaWyEU.js","./5kaKV4CP.js","./entry.CZH78m3A.css","./JaCKHA-1.js"])))=>i.map(i=>d[i]);
import{z as M,u as z,a as X,b as Y,c as Z,h as ee,d as te,_ as se,e as oe,f as ae,g as re}from"./JaCKHA-1.js";import{aj as ne,h as K,m as H,j as ie,H as le,av as P,p as O,o as b,x as B,w as l,b as i,q as o,K as k,c as T,z as S,a as C,t as q,F as G,L as de,d as J,aw as y,aB as ce,am as Q,e as ue,f as me,ay as x,az as pe}from"./5kaKV4CP.js";import{u as fe}from"./DYW9D5Pm.js";import{_ as ve}from"./DlAUqK2U.js";const _e=()=>ne("target-drivers","/target-drivers"),ge=ue(()=>me(()=>import("./CqY6xSgL.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(p=>p.default||p)),be=["innerHTML"],ye=["textContent"],Ce={class:"list-disc list-outside ml-4"},ke=["textContent"],he=K({__name:"Target",props:H({mode:{default:"create"},target:{}},{open:{type:Boolean},openModifiers:{}}),emits:H(["created","updated"],["update:open"]),setup(p,{emit:h}){const _=ie(p,"open"),c=h,w=le(),{data:g}=_e(),D=P({driver:null,config:{}}),u=O(()=>p.target||D),L=O(()=>{const a=Object.keys(g.value||{});return M.object({driver:a.length>0?M.enum([a[0],...a.slice(1)],{required_error:"Driver is required"}):M.string({required_error:"Driver is required"})})}),N=async()=>{var a,d,n,e;if(p.mode==="create"){const{status:t,error:s,data:r}=await z("/targets",{method:"post",body:u,watch:!1});if(t.value==="success"){const f=r.value;y().add({title:"Success",color:"success",description:f.message}),c("created")}else t.value==="error"&&y().add({title:"Error",description:((d=(a=s.value)==null?void 0:a.data)==null?void 0:d.error)||((n=s.value)==null?void 0:n.message),color:"red"})}else if(p.mode==="edit"){const{status:t,error:s,data:r}=await z(`/targets/${p.target.id}`,{method:"put",body:u,watch:!1});if(t.value==="success"){const f=r.value;y().add({title:"Success",color:"success",description:f.message}),c("updated")}else t.value==="error"&&y().add({title:"Error",description:(e=s.value)==null?void 0:e.message,color:"error"})}_.value=!1},V=async()=>{var e,t,s;if(await((e=w.value)==null?void 0:e.validate(void 0,{silent:!0}))===!1)return;const{status:a,error:d,data:n}=await z("/target-drivers/test",{method:"post",body:u,watch:!1});if(a.value==="success"){const r=n.value;y().add({title:"Success",color:"success",description:r.message});return}if(a.value==="error"&&[400,422,500].includes(((t=d.value)==null?void 0:t.statusCode)||0)){const r=(s=d.value)==null?void 0:s.data;y().add({title:"Error",description:r==null?void 0:r.error,color:"error"})}};return(a,d)=>{var m,$;const n=X,e=Y,t=Z,s=ce,r=ge,f=ee,F=Q,j=te;return b(),B(j,{title:{create:"New target",edit:`Edit target n°${(m=a.target)==null?void 0:m.id}`,read:`Target n° ${($=a.target)==null?void 0:$.id}`}[a.mode],description:"Configure data target",open:_.value,"onUpdate:open":d[1]||(d[1]=U=>_.value=U)},{body:l(()=>[i(f,{class:"space-y-4",state:o(u),schema:o(L),onSubmit:k(N,["prevent"]),ref_key:"formEl",ref:w,disabled:a.mode==="read",id:"targetForm"},{default:l(()=>{var U,I,R,A;return[i(e,{name:"driver",label:"Driver",required:""},{default:l(()=>[i(n,{options:Object.entries(o(g)||{}).map(([v,W])=>({value:v,item:W})),modelValue:o(u).driver,"onUpdate:modelValue":d[0]||(d[0]=v=>o(u).driver=v)},{default:l(({item:v})=>[v.config.image?(b(),T("span",{key:0,innerHTML:v.config.image,class:"nested-svg"},null,8,be)):S("",!0),C("span",{textContent:q(v.config.name)},null,8,ye)]),_:1},8,["options","modelValue"])]),_:1}),o(g)&&o(u).driver?(b(),T(G,{key:0},[(((A=(R=(I=(U=o(g))==null?void 0:U[o(u).driver])==null?void 0:I.config)==null?void 0:R.notes)==null?void 0:A.length)||0)>0?(b(),B(s,{key:0},{content:l(()=>[C("ul",Ce,[(b(!0),T(G,null,de(o(g)[o(u).driver].config.notes,v=>(b(),T("li",{textContent:q(v)},null,8,ke))),256))])]),default:l(()=>[i(t,{label:"Driver Notes"})]),_:1})):S("",!0),i(s,null,{default:l(()=>[i(t,{label:"Driver Configuration"}),i(r,{state:o(u).config,disabled:a.mode==="read",fields:o(g)[o(u).driver].fields},null,8,["state","disabled","fields"])]),_:1})],64)):S("",!0)]}),_:1},8,["state","schema","disabled"])]),footer:l(()=>[i(F,{type:"button",onClick:k(V,["prevent"]),variant:"soft",color:"secondary"},{default:l(()=>d[2]||(d[2]=[J(" Test configuration ")])),_:1}),a.mode!=="read"?(b(),B(F,{key:0,type:"submit",class:"ml-auto",form:"targetForm"},{default:l(()=>[J(q({create:"Create",edit:"Save changes"}[a.mode]),1)]),_:1})):S("",!0)]),_:1},8,["title","open"])}}}),E=ve(he,[["__scopeId","data-v-cd113215"]]),$e={class:"flex space-x-4"},xe={class:"flex gap-2 justify-end"},Te=K({__name:"targets",setup(p){var d;const{status:h,data:_,refresh:c}=fe(),w=(d=x())==null?void 0:d.isOpen,g=[{key:"id",label:"#",sortable:!0},{key:"excerpt",label:"Excerpt",sortable:!0},{key:"driver",label:"Driver",sortable:!0},{key:"actions"}],D=O(()=>{var n;return((n=_.value)==null?void 0:n.map(e=>({id:e.id,excerpt:e.excerpt,driver:e.driver})))||[]}),u=()=>{x().open(E,{mode:"create",onCreated:()=>c(),onUpdated:()=>c()})},L=n=>{var t;const e=(t=_.value)==null?void 0:t.find(s=>s.id===n);x().open(E,{mode:"read",target:e,onCreated:()=>c(),onUpdated:()=>c()})},N=n=>{var t;const e=(t=_.value)==null?void 0:t.find(s=>s.id===n);x().open(E,{mode:"edit",target:e,onCreated:()=>c(),onUpdated:()=>c()})},V=n=>{var t;const e=(t=_.value)==null?void 0:t.find(s=>s.id===n);x().open(E,{mode:"create",target:P({...JSON.parse(JSON.stringify(e))}),onCreated:()=>c(),onUpdated:()=>c()})},a=async n=>{var r;const{data:e,error:t,status:s}=await z(`/targets/${n}`,{method:"DELETE"});if(s.value==="error")y().add({color:"error",title:"Unable to delete target",description:(r=t.value)==null?void 0:r.message});else if(s.value==="success"){const f=e.value;y().add({color:"success",title:"Successfully deleted target",description:f.message})}await c()};return(n,e)=>{const t=oe,s=pe,r=Q,f=ae,F=re,j=se;return b(),B(j,{as:"section",id:"targets",ui:{body:"p-0 sm:p-0",header:"flex gap-x-2 justify-between items-center",footer:"text-sm leading-5 text-center"}},{header:l(()=>[e[3]||(e[3]=C("h1",null,"Targets",-1)),C("div",$e,[i(t,{kbds:["r"],label:"Refresh",color:"info",variant:"soft",icon:"i-heroicons-arrow-path-20-solid",onClick:e[0]||(e[0]=()=>o(c)()),loading:o(h)==="pending"||o(h)==="idle"},null,8,["loading"]),i(t,{kbds:["c"],label:"Create",variant:"soft","leading-icon":"i-heroicons-plus",disabled:o(w),onClick:e[1]||(e[1]=()=>u())},null,8,["disabled"])])]),footer:l(()=>{var m;return[e[4]||(e[4]=C("span",{class:"font-medium"},"Total: ",-1)),C("span",null,q(((m=o(D))==null?void 0:m.length)||0)+" targets",1)]}),default:l(()=>[i(F,{columns:g,rows:o(D),loading:["idle","pending"].includes(o(h)),sorting:[{desc:!0,id:"id"}]},{"cell-driver":l(({row:m})=>[i(s,{size:"sm",label:m.driver,color:"secondary",variant:"subtle"},null,8,["label"])]),"cell-actions":l(({row:m})=>[C("div",xe,[i(f,{items:[[{label:"Replicate",onSelect:()=>V(m.id)}]],onClick:e[2]||(e[2]=k(()=>{},["stop"]))},{default:l(()=>[i(r,{icon:"i-heroicons-ellipsis-horizontal",variant:"link",color:"neutral",class:"p-0",size:"xl"})]),_:2},1032,["items"]),i(r,{icon:"i-heroicons-eye",variant:"link",color:"neutral",size:"xl",onClick:k($=>L(m.id),["stop","prevent"]),class:"p-0"},null,8,["onClick"]),i(r,{icon:"i-heroicons-pencil-square",variant:"link",color:"neutral",size:"xl",onClick:k($=>N(m.id),["stop","prevent"]),class:"p-0"},null,8,["onClick"]),i(r,{icon:"i-heroicons-trash",variant:"link",color:"error",size:"xl",onClick:k($=>a(m.id),["stop","prevent"]),class:"p-0"},null,8,["onClick"])])]),_:1},8,["rows","loading"])]),_:1})}}});export{Te as default};
