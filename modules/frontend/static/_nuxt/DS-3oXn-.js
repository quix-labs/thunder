const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DdsvmdKe.js","./DI17Dj1R.js","./DeuV36H5.js","./entry.CZH78m3A.css","./BJ9VVGmp.js"])))=>i.map(i=>d[i]);
import{z as N,u as z,a as W,b as X,c as Y,h as Z,d as ee,_ as te,e as oe,f as se,g as ae}from"./BJ9VVGmp.js";import{aj as re,h as P,m as H,j as ne,H as ie,av as le,p as O,o as b,x as B,w as l,b as i,q as s,K as k,c as T,z as E,a as C,t as q,F as G,L as de,d as K,aw as y,aB as ce,am as J,e as ue,f as me,ay as x,ai as pe,az as fe}from"./DeuV36H5.js";import{u as ve}from"./D1qzFUbI.js";import{_ as _e}from"./DlAUqK2U.js";const ge=()=>re("target-drivers","/target-drivers"),be=ue(()=>me(()=>import("./DdsvmdKe.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(p=>p.default||p)),ye=["innerHTML"],Ce=["textContent"],ke={class:"list-disc list-outside ml-4"},he=["textContent"],$e=P({__name:"Target",props:H({mode:{default:"create"},target:{}},{open:{type:Boolean},openModifiers:{}}),emits:H(["created","updated"],["update:open"]),setup(p,{emit:h}){const _=ne(p,"open"),c=h,w=ie(),{data:g}=ge(),D=le({driver:null,config:{}}),u=O(()=>p.target||D),L=O(()=>{const a=Object.keys(g.value||{});return N.object({driver:a.length>0?N.enum([a[0],...a.slice(1)],{required_error:"Driver is required"}):N.string({required_error:"Driver is required"})})}),V=async()=>{var a,d,n,e;if(p.mode==="create"){const{status:t,error:o,data:r}=await z("/targets",{method:"post",body:u,watch:!1});if(t.value==="success"){const f=r.value;y().add({title:"Success",color:"success",description:f.message}),c("created")}else t.value==="error"&&y().add({title:"Error",description:((d=(a=o.value)==null?void 0:a.data)==null?void 0:d.error)||((n=o.value)==null?void 0:n.message),color:"red"})}else if(p.mode==="edit"){const{status:t,error:o,data:r}=await z(`/targets/${p.target.id}`,{method:"put",body:u,watch:!1});if(t.value==="success"){const f=r.value;y().add({title:"Success",color:"success",description:f.message}),c("updated")}else t.value==="error"&&y().add({title:"Error",description:(e=o.value)==null?void 0:e.message,color:"error"})}_.value=!1},j=async()=>{var e,t,o;if(await((e=w.value)==null?void 0:e.validate(void 0,{silent:!0}))===!1)return;const{status:a,error:d,data:n}=await z("/target-drivers/test",{method:"post",body:u,watch:!1});if(a.value==="success"){const r=n.value;y().add({title:"Success",color:"success",description:r.message});return}if(a.value==="error"&&[400,422,500].includes(((t=d.value)==null?void 0:t.statusCode)||0)){const r=(o=d.value)==null?void 0:o.data;y().add({title:"Error",description:r==null?void 0:r.error,color:"error"})}};return(a,d)=>{var m,$;const n=W,e=X,t=Y,o=ce,r=be,f=Z,F=J,M=ee;return b(),B(M,{title:{create:"New target",edit:`Edit target n°${(m=a.target)==null?void 0:m.id}`,read:`Target n° ${($=a.target)==null?void 0:$.id}`}[a.mode],description:"Configure data target",open:_.value,"onUpdate:open":d[1]||(d[1]=U=>_.value=U)},{body:l(()=>[i(f,{class:"space-y-4",state:s(u),schema:s(L),onSubmit:k(V,["prevent"]),ref_key:"formEl",ref:w,disabled:a.mode==="read",id:"targetForm"},{default:l(()=>{var U,R,I,A;return[i(e,{name:"driver",label:"Driver",required:""},{default:l(()=>[i(n,{options:Object.entries(s(g)||{}).map(([v,Q])=>({value:v,item:Q})),modelValue:s(u).driver,"onUpdate:modelValue":d[0]||(d[0]=v=>s(u).driver=v)},{default:l(({item:v})=>[v.config.image?(b(),T("span",{key:0,innerHTML:v.config.image,class:"nested-svg"},null,8,ye)):E("",!0),C("span",{textContent:q(v.config.name)},null,8,Ce)]),_:1},8,["options","modelValue"])]),_:1}),s(g)&&s(u).driver?(b(),T(G,{key:0},[(((A=(I=(R=(U=s(g))==null?void 0:U[s(u).driver])==null?void 0:R.config)==null?void 0:I.notes)==null?void 0:A.length)||0)>0?(b(),B(o,{key:0},{content:l(()=>[C("ul",ke,[(b(!0),T(G,null,de(s(g)[s(u).driver].config.notes,v=>(b(),T("li",{textContent:q(v)},null,8,he))),256))])]),default:l(()=>[i(t,{label:"Driver Notes"})]),_:1})):E("",!0),i(o,null,{default:l(()=>[i(t,{label:"Driver Configuration"}),i(r,{state:s(u).config,disabled:a.mode==="read",fields:s(g)[s(u).driver].fields},null,8,["state","disabled","fields"])]),_:1})],64)):E("",!0)]}),_:1},8,["state","schema","disabled"])]),footer:l(()=>[i(F,{type:"button",onClick:k(j,["prevent"]),variant:"soft",color:"secondary"},{default:l(()=>d[2]||(d[2]=[K(" Test configuration ")])),_:1}),a.mode!=="read"?(b(),B(F,{key:0,type:"submit",class:"ml-auto",form:"targetForm"},{default:l(()=>[K(q({create:"Create",edit:"Save changes"}[a.mode]),1)]),_:1})):E("",!0)]),_:1},8,["title","open"])}}}),S=_e($e,[["__scopeId","data-v-cd113215"]]),xe={class:"flex space-x-4"},we={class:"flex gap-2 justify-end"},Ee=P({__name:"targets",setup(p){var d;const{status:h,data:_,refresh:c}=ve(),w=(d=x())==null?void 0:d.isOpen,g=[{key:"id",label:"#",sortable:!0},{key:"excerpt",label:"Excerpt",sortable:!0},{key:"driver",label:"Driver",sortable:!0},{key:"actions"}],D=O(()=>{var n;return((n=_.value)==null?void 0:n.map(e=>({id:e.id,excerpt:e.excerpt,driver:e.driver})))||[]}),u=()=>{x().open(S,{mode:"create",onCreated:()=>c(),onUpdated:()=>c()})},L=n=>{var t;const e=(t=_.value)==null?void 0:t.find(o=>o.id===n);x().open(S,{mode:"read",target:e,onCreated:()=>c(),onUpdated:()=>c()})},V=n=>{var t;const e=(t=_.value)==null?void 0:t.find(o=>o.id===n);x().open(S,{mode:"edit",target:e,onCreated:()=>c(),onUpdated:()=>c()})},j=n=>{var t;const e=(t=_.value)==null?void 0:t.find(o=>o.id===n);x().open(S,{mode:"create",target:{...pe(e)},onCreated:()=>c(),onUpdated:()=>c()})},a=async n=>{var r;const{data:e,error:t,status:o}=await z(`/targets/${n}`,{method:"DELETE"});if(o.value==="error")y().add({color:"error",title:"Unable to delete target",description:(r=t.value)==null?void 0:r.message});else if(o.value==="success"){const f=e.value;y().add({color:"success",title:"Successfully deleted target",description:f.message})}await c()};return(n,e)=>{const t=oe,o=fe,r=J,f=se,F=ae,M=te;return b(),B(M,{as:"section",id:"targets",ui:{body:"p-0 sm:p-0",header:"flex gap-x-2 justify-between items-center",footer:"text-sm leading-5 text-center"}},{header:l(()=>[e[3]||(e[3]=C("h1",null,"Targets",-1)),C("div",xe,[i(t,{kbds:["r"],label:"Refresh",color:"info",variant:"soft",icon:"i-heroicons-arrow-path-20-solid",onClick:e[0]||(e[0]=()=>s(c)()),loading:s(h)==="pending"||s(h)==="idle"},null,8,["loading"]),i(t,{kbds:["c"],label:"Create",variant:"soft","leading-icon":"i-heroicons-plus",disabled:s(w),onClick:e[1]||(e[1]=()=>u())},null,8,["disabled"])])]),footer:l(()=>{var m;return[e[4]||(e[4]=C("span",{class:"font-medium"},"Total: ",-1)),C("span",null,q(((m=s(D))==null?void 0:m.length)||0)+" targets",1)]}),default:l(()=>[i(F,{columns:g,rows:s(D),loading:["idle","pending"].includes(s(h)),sorting:[{desc:!0,id:"id"}]},{"cell-driver":l(({row:m})=>[i(o,{size:"sm",label:m.driver,color:"secondary",variant:"subtle"},null,8,["label"])]),"cell-actions":l(({row:m})=>[C("div",we,[i(f,{items:[[{label:"Replicate",onSelect:()=>j(m.id)}]],onClick:e[2]||(e[2]=k(()=>{},["stop"]))},{default:l(()=>[i(r,{icon:"i-heroicons-ellipsis-horizontal",variant:"link",color:"neutral",class:"p-0",size:"xl"})]),_:2},1032,["items"]),i(r,{icon:"i-heroicons-eye",variant:"link",color:"neutral",size:"xl",onClick:k($=>L(m.id),["stop","prevent"]),class:"p-0"},null,8,["onClick"]),i(r,{icon:"i-heroicons-pencil-square",variant:"link",color:"neutral",size:"xl",onClick:k($=>V(m.id),["stop","prevent"]),class:"p-0"},null,8,["onClick"]),i(r,{icon:"i-heroicons-trash",variant:"link",color:"error",size:"xl",onClick:k($=>a(m.id),["stop","prevent"]),class:"p-0"},null,8,["onClick"])])]),_:1},8,["rows","loading"])]),_:1})}}});export{Ee as default};
