const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CzOwQkzr.js","./BDl_M9a8.js","./Cukv67TD.js","./entry.ZoznbJ9c.css","./BtAH9O33.js"])))=>i.map(i=>d[i]);
import{z as E,u as V,a as Q,b as W,c as X,f as Y,d as Z,_ as ee,e as z}from"./BtAH9O33.js";import{u as te}from"./CxifoVo1.js";import{ae as se,h as P,m as I,j as ae,H as re,ai as oe,p as q,o as f,x as D,w as o,b as l,q as t,K as A,c as w,y as x,a as b,t as F,F as H,L as ne,d as R,aj as g,aT as ie,ah as de,e as le,f as ce,al as G}from"./Cukv67TD.js";import{_ as ue}from"./DlAUqK2U.js";const me=()=>se("target-drivers","/target-drivers"),fe=le(()=>ce(()=>import("./CzOwQkzr.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(c=>c.default||c)),pe=["innerHTML"],ve=["textContent"],_e={class:"list-disc list-outside ml-4"},ge=["textContent"],be=P({__name:"Target",props:I({mode:{default:"create"},target:{}},{open:{type:Boolean},openModifiers:{}}),emits:I(["created","updated"],["update:open"]),setup(c,{emit:T}){const y=ae(c,"open"),v=T,$=re(),{data:m}=me(),S=oe({driver:null,config:{}}),s=q(()=>c.target||S),C=q(()=>{const e=Object.keys(m.value||{});return E.object({driver:e.length>0?E.enum([e[0],...e.slice(1)],{required_error:"Driver is required"}):E.string({required_error:"Driver is required"})})}),a=async()=>{var e,r,_,p;if(c.mode==="create"){const{status:n,error:d,data:i}=await V("/targets",{method:"post",body:s,watch:!1});if(n.value==="success"){const h=i.value;g().add({title:"Success",color:"success",description:h.message}),v("created")}else n.value==="error"&&g().add({title:"Error",description:((r=(e=d.value)==null?void 0:e.data)==null?void 0:r.error)||((_=d.value)==null?void 0:_.message),color:"red"})}else if(c.mode==="edit"){const{status:n,error:d,data:i}=await V(`/targets/${c.target.id}`,{method:"put",body:s,watch:!1});if(n.value==="success"){const h=i.value;g().add({title:"Success",color:"success",description:h.message}),v("updated")}else n.value==="error"&&g().add({title:"Error",description:(p=d.value)==null?void 0:p.message,color:"error"})}y.value=!1},U=async()=>{var p,n,d;if(await((p=$.value)==null?void 0:p.validate(void 0,{silent:!0}))===!1)return;const{status:e,error:r,data:_}=await V("/target-drivers/test",{method:"post",body:s,watch:!1});if(e.value==="success"){const i=_.value;g().add({title:"Success",color:"success",description:i.message});return}if(e.value==="error"&&[400,422,500].includes(((n=r.value)==null?void 0:n.statusCode)||0)){const i=(d=r.value)==null?void 0:d.data;g().add({title:"Error",description:i==null?void 0:i.error,color:"error"})}};return(e,r)=>{var j,B;const _=Q,p=W,n=X,d=ie,i=fe,h=Y,L=de,K=Z;return f(),D(K,{title:{create:"New target",edit:`Edit target n°${(j=e.target)==null?void 0:j.id}`,read:`Target n° ${(B=e.target)==null?void 0:B.id}`}[e.mode],description:"Configure data target",open:y.value,"onUpdate:open":r[1]||(r[1]=k=>y.value=k)},{body:o(()=>[l(h,{class:"space-y-4",state:t(s),schema:t(C),onSubmit:A(a,["prevent"]),ref_key:"formEl",ref:$,disabled:e.mode==="read",id:"targetForm"},{default:o(()=>{var k,M,N,O;return[l(p,{name:"driver",label:"Driver",required:""},{default:o(()=>[l(_,{options:Object.entries(t(m)||{}).map(([u,J])=>({value:u,item:J})),modelValue:t(s).driver,"onUpdate:modelValue":r[0]||(r[0]=u=>t(s).driver=u)},{default:o(({item:u})=>[u.config.image?(f(),w("span",{key:0,innerHTML:u.config.image,class:"nested-svg"},null,8,pe)):x("",!0),b("span",{textContent:F(u.config.name)},null,8,ve)]),_:1},8,["options","modelValue"])]),_:1}),t(m)&&t(s).driver?(f(),w(H,{key:0},[(((O=(N=(M=(k=t(m))==null?void 0:k[t(s).driver])==null?void 0:M.config)==null?void 0:N.notes)==null?void 0:O.length)||0)>0?(f(),D(d,{key:0},{content:o(()=>[b("ul",_e,[(f(!0),w(H,null,ne(t(m)[t(s).driver].config.notes,u=>(f(),w("li",{textContent:F(u)},null,8,ge))),256))])]),default:o(()=>[l(n,{label:"Driver Notes"})]),_:1})):x("",!0),l(d,null,{default:o(()=>[l(n,{label:"Driver Configuration"}),l(i,{state:t(s).config,fields:t(m)[t(s).driver].fields},null,8,["state","fields"])]),_:1})],64)):x("",!0)]}),_:1},8,["state","schema","disabled"])]),footer:o(()=>[l(L,{type:"button",onClick:A(U,["prevent"]),variant:"soft",color:"secondary"},{default:o(()=>r[2]||(r[2]=[R(" Test configuration ")])),_:1}),e.mode!=="read"?(f(),D(L,{key:0,type:"submit",class:"ml-auto",form:"targetForm"},{default:o(()=>[R(F({create:"Create",edit:"Save changes"}[e.mode]),1)]),_:1})):x("",!0)]),_:1},8,["title","open"])}}}),ye=ue(be,[["__scopeId","data-v-69ce3c16"]]),Ce={class:"flex space-x-4"},we=P({__name:"targets",setup(c){var s;const{status:T,data:y,refresh:v}=te(),$=(s=G())==null?void 0:s.isOpen,m=q(()=>{var C;return((C=y.value)==null?void 0:C.map(a=>({id:a.id,excerpt:a.excerpt,driver:a.driver})))||[]}),S=()=>{G().open(ye,{mode:"create",onCreated:()=>v(),onUpdated:()=>v()})};return(C,a)=>{const U=ee;return f(),D(U,{as:"section",id:"targets",ui:{header:"flex gap-x-2 justify-between items-center",footer:"text-sm leading-5 text-center"}},{header:o(()=>[a[2]||(a[2]=b("h1",null,"Targets",-1)),b("div",Ce,[l(z,{kbds:["r"],label:"Refresh",color:"info",variant:"soft",icon:"i-heroicons-arrow-path-20-solid",onClick:a[0]||(a[0]=()=>t(v)()),loading:t(T)==="pending"||t(T)==="idle"},null,8,["loading"]),l(z,{kbds:["c"],label:"Create",variant:"soft","leading-icon":"i-heroicons-plus",disabled:t($),onClick:a[1]||(a[1]=()=>S())},null,8,["disabled"])])]),footer:o(()=>{var e;return[a[3]||(a[3]=b("span",{class:"font-medium"},"Total: ",-1)),b("span",null,F(((e=t(m))==null?void 0:e.length)||0)+" targets",1)]}),_:1})}}});export{we as default};
