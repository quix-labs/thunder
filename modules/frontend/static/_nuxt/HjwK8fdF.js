const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DXxutvoB.js","./CfH4ePFN.js","./DJAyu_pX.js","./entry.DHJIpuq3.css","./4t6uwcST.js","./DXJZGQ7R.js","./DoHyfDZ5.js"])))=>i.map(i=>d[i]);
import{aj as z,e as R,A as T,C as W,N as J,x as K,h as U,o as m,i as C,w as n,b as u,j as t,k as B,c as y,m as b,a as L,t as D,V as M,W as Q,d as j,n as _,az as X,p as Y,q as Z,r as ee}from"./DJAyu_pX.js";import{z as S,_ as te,a as se,b as oe}from"./DoHyfDZ5.js";import{_ as re,a as ae}from"./DXJZGQ7R.js";import{u as F}from"./DeRnuWMo.js";import{_ as ne}from"./DlAUqK2U.js";const be=()=>z("sources","/sources"),ie=()=>z("source-drivers","/source-drivers"),ce=Z(()=>ee(()=>import("./DXxutvoB.js"),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url).then(d=>d.default||d)),de=["innerHTML"],ue=["textContent"],le={class:"list-disc list-outside ml-4"},me=["textContent"],fe=R({__name:"Source",props:T({mode:{default:"create"},source:{}},{open:{type:Boolean},openModifiers:{}}),emits:T(["created","updated"],["update:open"]),setup(d,{emit:x}){const h=W(d,"open"),k=x,w=J(),{data:f}=ie(),A=K({driver:null,config:{}}),o=U(()=>d.source||A),I=U(()=>{const e=Object.keys(f.value||{});return S.object({driver:e.length>0?S.enum([e[0],...e.slice(1)],{required_error:"Driver is required"}):S.string({required_error:"Driver is required"})})}),O=async()=>{var e,s,p,l;if(d.mode==="create"){const{status:r,error:i,data:a}=await F("/sources",{method:"post",body:o,watch:!1});if(r.value==="success"){const v=a.value;_().add({title:"Success",color:"success",description:v.message}),k("created")}else r.value==="error"&&_().add({title:"Error",description:((s=(e=i.value)==null?void 0:e.data)==null?void 0:s.error)||((p=i.value)==null?void 0:p.message),color:"error"})}else if(d.mode==="edit"){const{status:r,error:i,data:a}=await F(`/sources/${d.source.id}`,{method:"put",body:o,watch:!1});if(r.value==="success"){const v=a.value;_().add({title:"Success",color:"success",description:v.message}),k("updated")}else r.value==="error"&&_().add({title:"Error",description:(l=i.value)==null?void 0:l.message,color:"error"})}h.value=!1},G=async()=>{var l,r,i;if(await((l=w.value)==null?void 0:l.validate(void 0,{silent:!0}))===!1)return;const{status:e,error:s,data:p}=await F("/source-drivers/test",{method:"post",body:o,watch:!1});if(e.value==="success"){const a=p.value;_().add({title:"Success",color:"success",description:a.message});return}if(e.value==="error"&&[400,422,500].includes(((r=s.value)==null?void 0:r.statusCode)||0)){const a=(i=s.value)==null?void 0:i.data;_().add({title:"Error",description:a==null?void 0:a.error,color:"error"})}};return(e,s)=>{var $,E;const p=te,l=ae,r=se,i=X,a=ce,v=Y,H=oe;return m(),C(H,{title:{create:"New source",edit:`Edit source n°${($=e.source)==null?void 0:$.id}`,read:`Source n° ${(E=e.source)==null?void 0:E.id}`}[e.mode],description:"Configure data source",open:h.value,"onUpdate:open":s[1]||(s[1]=g=>h.value=g)},{body:n(()=>[u(t(re),{class:"space-y-4",state:t(o),schema:t(I),onSubmit:B(O,["prevent"]),ref_key:"formEl",ref:w,disabled:e.mode==="read",id:"sourceForm"},{default:n(()=>{var g,V,q,N;return[u(l,{name:"driver",label:"Driver",required:""},{default:n(()=>[u(p,{options:Object.entries(t(f)||{}).map(([c,P])=>({value:c,item:P})),modelValue:t(o).driver,"onUpdate:modelValue":s[0]||(s[0]=c=>t(o).driver=c)},{default:n(({item:c})=>[c.config.image?(m(),y("span",{key:0,innerHTML:c.config.image,class:"nested-svg"},null,8,de)):b("",!0),L("span",{textContent:D(c.config.name)},null,8,ue)]),_:1},8,["options","modelValue"])]),_:1}),t(f)&&t(o).driver?(m(),y(M,{key:0},[(((N=(q=(V=(g=t(f))==null?void 0:g[t(o).driver])==null?void 0:V.config)==null?void 0:q.notes)==null?void 0:N.length)||0)>0?(m(),C(i,{key:0,"default-open":""},{content:n(()=>[L("ul",le,[(m(!0),y(M,null,Q(t(f)[t(o).driver].config.notes,c=>(m(),y("li",{textContent:D(c)},null,8,me))),256))])]),default:n(()=>[u(r,{label:"Driver Notes",type:"dashed"})]),_:1})):b("",!0),u(i,{"default-open":""},{content:n(()=>[u(a,{state:t(o).config,disabled:e.mode==="read",fields:t(f)[t(o).driver].fields},null,8,["state","disabled","fields"])]),default:n(()=>[u(r,{label:"Driver Configuration"})]),_:1})],64)):b("",!0)]}),_:1},8,["state","schema","disabled"])]),footer:n(()=>[u(v,{type:"button",onClick:B(G,["prevent"]),variant:"soft",color:"secondary"},{default:n(()=>s[2]||(s[2]=[j(" Test configuration ")])),_:1}),e.mode!=="read"?(m(),C(v,{key:0,type:"submit",class:"ml-auto",form:"sourceForm"},{default:n(()=>[j(D({create:"Create",edit:"Save changes"}[e.mode]),1)]),_:1})):b("",!0)]),_:1},8,["title","open"])}}}),he=ne(fe,[["__scopeId","data-v-83b75755"]]);export{he as F,be as u};
