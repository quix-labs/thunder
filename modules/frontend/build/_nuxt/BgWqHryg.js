import{a as Y,_ as L,b as Z,c as z}from"./BqDvm4nM.js";import{g as R,S as M,R as J,o as a,c as d,P as N,H as h,w as l,t as V,F as D,r as A,U as W,f as X,b as x,a as m,O as U,d as G,J as w,N as o,Q as H,Y as ee,ai as te,aJ as oe,Z as C}from"./COGry_M7.js";import{b as F,_ as ae,a as re}from"./ChJoUEp7.js";const ne={key:2},se=R({__name:"DynamicFieldsForm",props:M({fields:{default:()=>[]}},{modelValue:{default:{}},modelModifiers:{}}),emits:["update:modelValue"],setup(f){const v=J(f,"modelValue");return(b,S)=>{const g=Y,i=L;return a(!0),d(D,null,N(b.fields,e=>(a(),h(i,{required:e.required,label:e.label,name:`config.${e.name}`,help:e.help},{default:l(()=>[["number"].includes(e.type)?(a(),h(g,{key:0,autocomplete:"off",type:"number",placeholder:e.default,min:e.min,max:e.max,value:v.value[e.name],onInput:t=>v.value[e.name]=t.target.value===""?void 0:parseFloat(t.target.value)},null,8,["placeholder","min","max","value","onInput"])):["text","password"].includes(e.type)?(a(),h(g,{key:1,autocomplete:"off",type:e.type,placeholder:e.default,modelValue:v.value[e.name],"onUpdate:modelValue":t=>v.value[e.name]=t},null,8,["type","placeholder","modelValue","onUpdate:modelValue"])):(a(),d("span",ne,V(e.type)+" not supported!",1))]),_:2},1032,["required","label","name","help"]))),256)}}});function le(){return F("/target-drivers")}const de={class:"text-center text-2xl font-semibold"},ie=["disabled"],ue={class:"grid grid-cols-2 gap-4"},ce=["onUpdate:modelValue","value","id"],me=["for","onKeydown"],pe=["innerHTML"],_e=["textContent"],fe={key:0},ve={class:"list-disc list-outside ml-4"},ge=["textContent"],ye={class:"flex"},we=R({__name:"TargetForm",props:M({mode:{default:"create"},target:{},targetId:{}},{opened:{},openedModifiers:{}}),emits:M(["created","updated"],["update:opened"]),setup(f,{emit:v}){const b=J(f,"opened"),S=v,g=A(),{data:i}=le(),e=W({driver:null,config:{}}),t=X(()=>f.target||e),E=async()=>{var n,r,y;if(f.mode==="create"){const{status:u,error:p,data:_}=await F("/targets",{method:"post",body:t,watch:!1});if(u.value==="success"){const s=_.value;C().add({title:"Success",color:"green",description:s.message}),S("created"),b.value=!1;return}u.value==="error"&&C().add({title:"Error",description:((r=(n=p.value)==null?void 0:n.data)==null?void 0:r.error)||((y=p.value)==null?void 0:y.message),color:"red"})}else f.mode},j=async()=>{var u,p,_;if(await((u=g.value)==null?void 0:u.validate(void 0,{silent:!0}))===!1)return;const{status:n,error:r,data:y}=await F("/target-drivers/test",{method:"post",body:t,watch:!1});if(n.value==="success"){const s=y.value;C().add({title:"Success",color:"green",description:s.message});return}if(n.value==="error"&&[400,422,500].includes(((p=r.value)==null?void 0:p.statusCode)||0)){const s=(_=r.value)==null?void 0:_.data;C().add({title:"Error",description:s==null?void 0:s.error,color:"red"})}};return(n,r)=>{const y=L,u=Z,p=se,_=ee,s=ae,P=z,Q=re;return a(),h(Q,{modelValue:b.value,"onUpdate:modelValue":r[2]||(r[2]=k=>b.value=k),class:"overflow-y-auto",onKeydown:H(U(E,["ctrl","prevent"]),["enter"])},{default:l(()=>[x(P,{class:"flex flex-col flex-1",state:o(t),onSubmit:U(E,["prevent"]),ref_key:"formEl",ref:g},{default:l(()=>[x(s,{class:"flex flex-col flex-1",ui:{body:{base:"flex-1"},rounded:""}},{header:l(()=>[m("h2",de,V({create:"New target",edit:"Edit target: TODO id",read:"Target: TODO id"}[n.mode]),1)]),footer:l(()=>[m("div",ye,[x(_,{type:"button",onClick:U(j,["prevent"]),variant:"soft",color:"sky"},{default:l(()=>r[3]||(r[3]=[G(" Test configuration ")])),_:1}),n.mode!=="read"?(a(),h(_,{key:0,type:"submit",class:"ml-auto"},{default:l(()=>[G(V({create:"Create",edit:"Save changes"}[n.mode]),1)]),_:1})):w("",!0)])]),default:l(()=>{var k,O,q,B,K;return[m("fieldset",{disabled:n.mode==="read",class:"grid gap-y-4"},[x(y,{label:"Driver",required:"",name:"driver"},{default:l(()=>[m("div",ue,[(a(!0),d(D,null,N(Object.entries(o(i)||{}),([c,T])=>(a(),d("div",null,[te(m("input",{type:"radio",name:"driver","onUpdate:modelValue":$=>o(t).driver=$,value:c,class:"sr-only peer",id:`driver-${c}`,onChange:r[0]||(r[0]=$=>{var I;return(I=o(g))==null?void 0:I.clear()}),tabindex:"-1"},null,40,ce),[[oe,o(t).driver]]),m("label",{for:`driver-${c}`,tabindex:"0",onKeydown:H(U($=>o(t).driver=c,["prevent"]),["enter","space"]),class:"cursor-pointer peer-disabled:cursor-not-allowed flex flex-col gap-y-1 text-center items-center rounded-lg p-4 text-gray-900 dark:text-white bg-white dark:bg-gray-900 ring-1 ring-gray-200 dark:ring-gray-800 peer-checked:ring-2 peer-checked:ring-primary-500"},[T.config.image?(a(),d("span",{key:0,innerHTML:T.config.image,class:"nested-svg"},null,8,pe)):w("",!0),m("span",{textContent:V(T.config.name)},null,8,_e)],40,me)]))),256))])]),_:1}),o(i)&&o(t).driver?(a(),d(D,{key:0},[((q=(O=(k=o(i)[o(t).driver])==null?void 0:k.config)==null?void 0:O.notes)==null?void 0:q.length)>0?(a(),d("div",fe,[x(u,{label:"Driver Notes"}),m("ul",ve,[(a(!0),d(D,null,N((K=(B=o(i)[o(t).driver])==null?void 0:B.config)==null?void 0:K.notes,c=>(a(),d("li",{textContent:V(c)},null,8,ge))),256))])])):w("",!0),x(u,{label:"Driver Configuration"}),o(i)&&o(t).driver?(a(),h(p,{key:1,modelValue:o(t).config,"onUpdate:modelValue":r[1]||(r[1]=c=>o(t).config=c),fields:o(i)[o(t).driver].fields},null,8,["modelValue","fields"])):w("",!0)],64)):w("",!0)],8,ie)]}),_:1})]),_:1},8,["state"])]),_:1},8,["modelValue","onKeydown"])}}});function Ve(){return F("/targets")}export{we as _,Ve as u};
