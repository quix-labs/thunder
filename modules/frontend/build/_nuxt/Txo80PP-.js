const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CIeEQiT1.js","./DlbPLHy5.js","./BtwgJjUD.js","./entry.DSrKHs56.css","./DBOZ3qfk.js"])))=>i.map(i=>d[i]);
import{g as K,S as M,R as P,r as $,U as A,f as B,o as c,H as D,w as u,b as _,a as y,t as C,O as S,d as L,J as b,N as e,c as h,F as j,P as G,V as J,Q,W,X,Y,Z as v,_ as Z}from"./BtwgJjUD.js";import{z as k,b as ee,a as te,c as oe}from"./DBOZ3qfk.js";import{b as x,_ as se,a as re}from"./CElnJIvZ.js";function ae(){return x("/source-drivers")}const ne=W(()=>X(()=>import("./CIeEQiT1.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(l=>l.default||l)),de={class:"text-center text-2xl font-semibold"},le=["disabled"],ie=["innerHTML"],ce=["textContent"],ue={key:0},me={class:"list-disc list-outside ml-4"},fe=["textContent"],_e={class:"flex"},ve=K({__name:"SourceForm",props:M({mode:{default:"create"},source:{},sourceId:{}},{opened:{},openedModifiers:{}}),emits:M(["created","updated"],["update:opened"]),setup(l,{emit:q}){const w=P(l,"opened"),U=q,E=$(),{data:m}=ae(),O=A({driver:null,config:{}}),s=B(()=>l.source||O),p=$(),R=B(()=>{let t=k.object({driver:k.enum(Object.keys(m.value||{}),{required_error:"Driver is required"})});return s.value.driver&&p.value&&(t=t.merge(k.object({config:p.value}))),t}),F=async()=>{var t,o,f,i;if(l.mode==="create"){const{status:n,error:d,data:a}=await x("/sources",{method:"post",body:s,watch:!1});if(n.value==="success"){const g=a.value;v().add({title:"Success",color:"green",description:g.message}),U("created"),w.value=!1;return}n.value==="error"&&v().add({title:"Error",description:((o=(t=d.value)==null?void 0:t.data)==null?void 0:o.error)||((f=d.value)==null?void 0:f.message),color:"red"})}else if(l.mode==="edit"){const{status:n,error:d,data:a}=await x(`/sources/${l.sourceId}`,{method:"put",body:s,watch:!1});if(n.value==="success"){const g=a.value;v().add({title:"Success",color:"green",description:g.message}),U("updated"),w.value=!1;return}n.value==="error"&&v().add({title:"Error",description:(i=d.value)==null?void 0:i.message,color:"red"})}},z=async()=>{var i,n,d;if(await((i=E.value)==null?void 0:i.validate(void 0,{silent:!0}))===!1)return;const{status:t,error:o,data:f}=await x("/source-drivers/test",{method:"post",body:s,watch:!1});if(t.value==="success"){const a=f.value;v().add({title:"Success",color:"green",description:a.message});return}if(t.value==="error"&&[400,422,500].includes(((n=o.value)==null?void 0:n.statusCode)||0)){const a=(d=o.value)==null?void 0:d.data;v().add({title:"Error",description:a==null?void 0:a.error,color:"red"})}};return(t,o)=>{const f=ee,i=te,n=ne,d=Y,a=se,g=oe,H=re;return c(),D(H,{modelValue:w.value,"onUpdate:modelValue":o[3]||(o[3]=V=>w.value=V),class:"overflow-y-auto",onKeydown:Q(S(F,["ctrl","prevent"]),["enter"])},{default:u(()=>[_(g,{class:"flex flex-col flex-1",state:e(s),schema:e(R),onSubmit:S(F,["prevent"]),ref_key:"formEl",ref:E},{default:u(()=>[_(a,{class:"flex flex-col flex-1",ui:{body:{base:"flex-1"},rounded:""}},{header:u(()=>[y("h2",de,C({create:"New source",edit:`Edit source n°${t.sourceId}`,read:`Source n° ${t.sourceId}`}[t.mode]),1)]),footer:u(()=>[y("div",_e,[_(d,{type:"button",onClick:S(z,["prevent"]),variant:"soft",color:"sky"},{default:u(()=>o[4]||(o[4]=[L(" Test configuration ")])),_:1}),t.mode!=="read"?(c(),D(d,{key:0,type:"submit",class:"ml-auto"},{default:u(()=>[L(C({create:"Create",edit:"Save changes"}[t.mode]),1)]),_:1})):b("",!0)])]),default:u(()=>{var V,I,N,T;return[y("fieldset",{disabled:t.mode==="read",class:"grid gap-y-4"},[_(f,{name:"driver",label:"Driver",required:"",options:Object.values(e(m)||{}).map(r=>({value:r.config.ID,item:r})),modelValue:e(s).driver,"onUpdate:modelValue":o[0]||(o[0]=r=>e(s).driver=r)},{default:u(({item:r})=>[r.config.image?(c(),h("span",{key:0,innerHTML:r.config.image,class:"nested-svg"},null,8,ie)):b("",!0),y("span",{textContent:C(r.config.name)},null,8,ce)]),_:1},8,["options","modelValue"]),e(m)&&e(s).driver?(c(),h(j,{key:0},[(((T=(N=(I=(V=e(m))==null?void 0:V[e(s).driver])==null?void 0:I.config)==null?void 0:N.notes)==null?void 0:T.length)||0)>0?(c(),h("div",ue,[_(i,{label:"Driver Notes"}),y("ul",me,[(c(!0),h(j,null,G(e(m)[e(s).driver].config.notes,r=>(c(),h("li",{textContent:C(r)},null,8,fe))),256))])])):b("",!0),_(i,{label:"Driver Configuration"}),e(m)&&e(s).driver?(c(),D(n,{key:1,modelValue:e(s).config,"onUpdate:modelValue":o[1]||(o[1]=r=>e(s).config=r),schema:e(p),"onUpdate:schema":o[2]||(o[2]=r=>J(p)?p.value=r:null),fields:e(m)[e(s).driver].fields},null,8,["modelValue","schema","fields"])):b("",!0)],64)):b("",!0)],8,le)]}),_:1})]),_:1},8,["state","schema"])]),_:1},8,["modelValue","onKeydown"])}}}),be=Z(ve,[["__scopeId","data-v-bd89e2a0"]]);function he(){return x("/sources")}export{be as _,he as u};
