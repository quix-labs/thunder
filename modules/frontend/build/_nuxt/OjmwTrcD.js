import{a as Y,_ as R,b as Z,c as z}from"./Bd7Rp3Wh.js";import{g as J,S as E,R as j,o as a,c as u,P as N,H as w,w as i,t as U,F as T,r as A,U as W,f as X,b as x,a as _,O as F,d as H,J as k,N as o,Q as L,Y as ee,ai as te,aJ as oe,Z as b}from"./BKG60nu4.js";import{b as D,_ as ae,a as re}from"./DeTryvP5.js";const ne={key:2},se=J({__name:"DynamicFieldsForm",props:E({fields:{default:()=>[]}},{modelValue:{default:{}},modelModifiers:{}}),emits:["update:modelValue"],setup(v){const f=j(v,"modelValue");return(g,$)=>{const y=Y,c=R;return a(!0),u(T,null,N(g.fields,t=>(a(),w(c,{required:t.required,label:t.label,name:`config.${t.name}`,help:t.help},{default:i(()=>[["number"].includes(t.type)?(a(),w(y,{key:0,autocomplete:"off",type:"number",placeholder:t.default,min:t.min,max:t.max,value:f.value[t.name],onInput:e=>f.value[t.name]=e.target.value===""?void 0:parseFloat(e.target.value)},null,8,["placeholder","min","max","value","onInput"])):["text","password"].includes(t.type)?(a(),w(y,{key:1,autocomplete:"off",type:t.type,placeholder:t.default,modelValue:f.value[t.name],"onUpdate:modelValue":e=>f.value[t.name]=e},null,8,["type","placeholder","modelValue","onUpdate:modelValue"])):(a(),u("span",ne,U(t.type)+" not supported!",1))]),_:2},1032,["required","label","name","help"]))),256)}}});function le(){return D("/target-drivers")}const de={class:"text-center text-2xl font-semibold"},ie=["disabled"],ue={class:"grid grid-cols-2 gap-4"},ce=["onUpdate:modelValue","value","id"],me=["for","onKeydown"],pe=["innerHTML"],_e=["textContent"],ve={key:0},fe={class:"list-disc list-outside ml-4"},ge=["textContent"],ye={class:"flex"},we=J({__name:"TargetForm",props:E({mode:{default:"create"},target:{},targetId:{}},{opened:{},openedModifiers:{}}),emits:E(["created","updated"],["update:opened"]),setup(v,{emit:f}){const g=j(v,"opened"),$=f,y=A(),{data:c}=le(),t=W({driver:null,config:{}}),e=X(()=>v.target||t),O=async()=>{var s,r,h,m;if(v.mode==="create"){const{status:l,error:d,data:n}=await D("/targets",{method:"post",body:e,watch:!1});if(l.value==="success"){const V=n.value;b().add({title:"Success",color:"green",description:V.message}),$("created"),g.value=!1;return}l.value==="error"&&b().add({title:"Error",description:((r=(s=d.value)==null?void 0:s.data)==null?void 0:r.error)||((h=d.value)==null?void 0:h.message),color:"red"})}else if(v.mode==="edit"){const{status:l,error:d,data:n}=await D(`/targets/${v.targetId}`,{method:"put",body:e,watch:!1});if(l.value==="success"){const V=n.value;b().add({title:"Success",color:"green",description:V.message}),$("updated"),g.value=!1;return}l.value==="error"&&b().add({title:"Error",description:(m=d.value)==null?void 0:m.message,color:"red"})}},P=async()=>{var m,l,d;if(await((m=y.value)==null?void 0:m.validate(void 0,{silent:!0}))===!1)return;const{status:s,error:r,data:h}=await D("/target-drivers/test",{method:"post",body:e,watch:!1});if(s.value==="success"){const n=h.value;b().add({title:"Success",color:"green",description:n.message});return}if(s.value==="error"&&[400,422,500].includes(((l=r.value)==null?void 0:l.statusCode)||0)){const n=(d=r.value)==null?void 0:d.data;b().add({title:"Error",description:n==null?void 0:n.error,color:"red"})}};return(s,r)=>{const h=R,m=Z,l=se,d=ee,n=ae,V=z,Q=re;return a(),w(Q,{modelValue:g.value,"onUpdate:modelValue":r[2]||(r[2]=C=>g.value=C),class:"overflow-y-auto",onKeydown:L(F(O,["ctrl","prevent"]),["enter"])},{default:i(()=>[x(V,{class:"flex flex-col flex-1",state:o(e),onSubmit:F(O,["prevent"]),ref_key:"formEl",ref:y},{default:i(()=>[x(n,{class:"flex flex-col flex-1",ui:{body:{base:"flex-1"},rounded:""}},{header:i(()=>[_("h2",de,U({create:"New target",edit:"Edit target: TODO id",read:"Target: TODO id"}[s.mode]),1)]),footer:i(()=>[_("div",ye,[x(d,{type:"button",onClick:F(P,["prevent"]),variant:"soft",color:"sky"},{default:i(()=>r[3]||(r[3]=[H(" Test configuration ")])),_:1}),s.mode!=="read"?(a(),w(d,{key:0,type:"submit",class:"ml-auto"},{default:i(()=>[H(U({create:"Create",edit:"Save changes"}[s.mode]),1)]),_:1})):k("",!0)])]),default:i(()=>{var C,q,B,I,K;return[_("fieldset",{disabled:s.mode==="read",class:"grid gap-y-4"},[x(h,{label:"Driver",required:"",name:"driver"},{default:i(()=>[_("div",ue,[(a(!0),u(T,null,N(Object.entries(o(c)||{}),([p,M])=>(a(),u("div",null,[te(_("input",{type:"radio",name:"driver","onUpdate:modelValue":S=>o(e).driver=S,value:p,class:"sr-only peer",id:`driver-${p}`,onChange:r[0]||(r[0]=S=>{var G;return(G=o(y))==null?void 0:G.clear()}),tabindex:"-1"},null,40,ce),[[oe,o(e).driver]]),_("label",{for:`driver-${p}`,tabindex:"0",onKeydown:L(F(S=>o(e).driver=p,["prevent"]),["enter","space"]),class:"cursor-pointer peer-disabled:cursor-not-allowed flex flex-col gap-y-1 text-center items-center rounded-lg p-4 text-gray-900 dark:text-white bg-white dark:bg-gray-900 ring-1 ring-gray-200 dark:ring-gray-800 peer-checked:ring-2 peer-checked:ring-primary-500"},[M.config.image?(a(),u("span",{key:0,innerHTML:M.config.image,class:"nested-svg"},null,8,pe)):k("",!0),_("span",{textContent:U(M.config.name)},null,8,_e)],40,me)]))),256))])]),_:1}),o(c)&&o(e).driver?(a(),u(T,{key:0},[((B=(q=(C=o(c)[o(e).driver])==null?void 0:C.config)==null?void 0:q.notes)==null?void 0:B.length)>0?(a(),u("div",ve,[x(m,{label:"Driver Notes"}),_("ul",fe,[(a(!0),u(T,null,N((K=(I=o(c)[o(e).driver])==null?void 0:I.config)==null?void 0:K.notes,p=>(a(),u("li",{textContent:U(p)},null,8,ge))),256))])])):k("",!0),x(m,{label:"Driver Configuration"}),o(c)&&o(e).driver?(a(),w(l,{key:1,modelValue:o(e).config,"onUpdate:modelValue":r[1]||(r[1]=p=>o(e).config=p),fields:o(c)[o(e).driver].fields},null,8,["modelValue","fields"])):k("",!0)],64)):k("",!0)],8,ie)]}),_:1})]),_:1},8,["state"])]),_:1},8,["modelValue","onKeydown"])}}});function Ve(){return D("/targets")}export{we as _,Ve as u};
