const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./KJbEtpFx.js","./DowyIwUz.js","./BTDLtqxA.js","./entry.DSrKHs56.css","./B5YJUb8b.js"])))=>i.map(i=>d[i]);
import{g as K,S as $,R as P,r as B,U as A,f as L,o as c,H as k,w as u,b as v,a as h,t as D,O as T,d as j,J as x,N as e,c as w,F as q,P as G,V as J,Q,W,X,Y,Z as p,_ as Z}from"./BTDLtqxA.js";import{z as U,b as ee,a as te,c as oe}from"./B5YJUb8b.js";import{b as V,_ as ae,a as se}from"./DwWviSL3.js";function re(){return V("/target-drivers")}const ne=W(()=>X(()=>import("./KJbEtpFx.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(l=>l.default||l)),de={class:"text-center text-2xl font-semibold"},le=["disabled"],ie=["innerHTML"],ce=["textContent"],ue={key:0},me={class:"list-disc list-outside ml-4"},fe=["textContent"],_e={class:"flex"},ve=K({__name:"TargetForm",props:$({mode:{default:"create"},target:{}},{opened:{},openedModifiers:{}}),emits:$(["created","updated"],["update:opened"]),setup(l,{emit:I}){const C=P(l,"opened"),E=I,F=B(),{data:m}=re(),O=A({driver:null,config:{}}),a=L(()=>l.target||O),g=B(),R=L(()=>{let t=U.object({driver:U.enum(Object.keys(m.value||{}),{required_error:"Driver is required"})});return a.value.driver&&g.value&&(t=t.merge(U.object({config:g.value}))),t}),S=async()=>{var t,o,_,i;if(l.mode==="create"){const{status:n,error:d,data:r}=await V("/targets",{method:"post",body:a,watch:!1});if(n.value==="success"){const y=r.value;p().add({title:"Success",color:"green",description:y.message}),E("created"),C.value=!1;return}n.value==="error"&&p().add({title:"Error",description:((o=(t=d.value)==null?void 0:t.data)==null?void 0:o.error)||((_=d.value)==null?void 0:_.message),color:"red"})}else if(l.mode==="edit"){const{status:n,error:d,data:r}=await V(`/targets/${l.target.id}`,{method:"put",body:a,watch:!1});if(n.value==="success"){const y=r.value;p().add({title:"Success",color:"green",description:y.message}),E("updated"),C.value=!1;return}n.value==="error"&&p().add({title:"Error",description:(i=d.value)==null?void 0:i.message,color:"red"})}},z=async()=>{var i,n,d;if(await((i=F.value)==null?void 0:i.validate(void 0,{silent:!0}))===!1)return;const{status:t,error:o,data:_}=await V("/target-drivers/test",{method:"post",body:a,watch:!1});if(t.value==="success"){const r=_.value;p().add({title:"Success",color:"green",description:r.message});return}if(t.value==="error"&&[400,422,500].includes(((n=o.value)==null?void 0:n.statusCode)||0)){const r=(d=o.value)==null?void 0:d.data;p().add({title:"Error",description:r==null?void 0:r.error,color:"red"})}};return(t,o)=>{const _=ee,i=te,n=ne,d=Y,r=ae,y=oe,H=se;return c(),k(H,{modelValue:C.value,"onUpdate:modelValue":o[3]||(o[3]=f=>C.value=f),class:"overflow-y-auto",onKeydown:Q(T(S,["ctrl","prevent"]),["enter"])},{default:u(()=>[v(y,{class:"flex flex-col flex-1",state:e(a),schema:e(R),onSubmit:T(S,["prevent"]),ref_key:"formEl",ref:F},{default:u(()=>[v(r,{class:"flex flex-col flex-1",ui:{body:{base:"flex-1"},rounded:""}},{header:u(()=>{var f,b;return[h("h2",de,D({create:"New target",edit:`Edit target n°${(f=t.target)==null?void 0:f.id}`,read:`Target n° ${(b=t.target)==null?void 0:b.id}`}[t.mode]),1)]}),footer:u(()=>[h("div",_e,[v(d,{type:"button",onClick:T(z,["prevent"]),variant:"soft",color:"sky"},{default:u(()=>o[4]||(o[4]=[j(" Test configuration ")])),_:1}),t.mode!=="read"?(c(),k(d,{key:0,type:"submit",class:"ml-auto"},{default:u(()=>[j(D({create:"Create",edit:"Save changes"}[t.mode]),1)]),_:1})):x("",!0)])]),default:u(()=>{var f,b,N,M;return[h("fieldset",{disabled:t.mode==="read",class:"grid gap-y-4"},[v(_,{name:"driver",label:"Driver",required:"",options:Object.values(e(m)||{}).map(s=>({value:s.config.ID,item:s})),modelValue:e(a).driver,"onUpdate:modelValue":o[0]||(o[0]=s=>e(a).driver=s)},{default:u(({item:s})=>[s.config.image?(c(),w("span",{key:0,innerHTML:s.config.image,class:"nested-svg"},null,8,ie)):x("",!0),h("span",{textContent:D(s.config.name)},null,8,ce)]),_:1},8,["options","modelValue"]),e(m)&&e(a).driver?(c(),w(q,{key:0},[(((M=(N=(b=(f=e(m))==null?void 0:f[e(a).driver])==null?void 0:b.config)==null?void 0:N.notes)==null?void 0:M.length)||0)>0?(c(),w("div",ue,[v(i,{label:"Driver Notes"}),h("ul",me,[(c(!0),w(q,null,G(e(m)[e(a).driver].config.notes,s=>(c(),w("li",{textContent:D(s)},null,8,fe))),256))])])):x("",!0),v(i,{label:"Driver Configuration"}),e(m)&&e(a).driver?(c(),k(n,{key:1,modelValue:e(a).config,"onUpdate:modelValue":o[1]||(o[1]=s=>e(a).config=s),schema:e(g),"onUpdate:schema":o[2]||(o[2]=s=>J(g)?g.value=s:null),fields:e(m)[e(a).driver].fields},null,8,["modelValue","schema","fields"])):x("",!0)],64)):x("",!0)],8,le)]}),_:1})]),_:1},8,["state","schema"])]),_:1},8,["modelValue","onKeydown"])}}}),be=Z(ve,[["__scopeId","data-v-4c459552"]]);function he(){return V("/targets")}export{be as _,he as u};
