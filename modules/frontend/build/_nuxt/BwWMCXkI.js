const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./X0V6qsrh.js","./B9rY3amy.js","./CD5hUaAV.js","./entry.DSrKHs56.css","./DEi0poqG.js","./C_TKe6c3.js"])))=>i.map(i=>d[i]);
import{aH as z,g as K,S as L,R as P,r as M,U as G,f as B,o as c,H as D,w as u,b as v,a as h,t as C,O as S,d as j,J as x,N as e,c as w,F as q,P as J,V as Q,Q as W,W as X,X as Y,Y as Z,Z as p,_ as ee}from"./CD5hUaAV.js";import{z as k,a as te,_ as oe}from"./C_TKe6c3.js";import{_ as se,a as re,b as U}from"./CuAb3WZH.js";import{a as ae}from"./DEi0poqG.js";const ne=()=>z("source-drivers","/source-drivers"),de=Y(()=>Z(()=>import("./X0V6qsrh.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url).then(l=>l.default||l)),le={class:"text-center text-2xl font-semibold"},ie=["disabled"],ce=["innerHTML"],ue=["textContent"],me={key:0},fe={class:"list-disc list-outside ml-4"},_e=["textContent"],ve={class:"flex"},pe=K({__name:"SourceForm",props:L({mode:{default:"create"},source:{}},{opened:{},openedModifiers:{}}),emits:L(["created","updated"],["update:opened"]),setup(l,{emit:H}){const V=P(l,"opened"),E=H,F=M(),{data:m}=ne(),I=G({driver:null,config:{}}),s=B(()=>l.source||I),g=M(),O=B(()=>{let t=k.object({driver:k.enum(Object.keys(m.value||{}),{required_error:"Driver is required"})});return s.value.driver&&g.value&&(t=t.merge(k.object({config:g.value}))),t}),N=async()=>{var t,o,_,i;if(l.mode==="create"){const{status:n,error:d,data:a}=await U("/sources",{method:"post",body:s,watch:!1});if(n.value==="success"){const y=a.value;p().add({title:"Success",color:"green",description:y.message}),E("created"),V.value=!1;return}n.value==="error"&&p().add({title:"Error",description:((o=(t=d.value)==null?void 0:t.data)==null?void 0:o.error)||((_=d.value)==null?void 0:_.message),color:"red"})}else if(l.mode==="edit"){const{status:n,error:d,data:a}=await U(`/sources/${l.source.id}`,{method:"put",body:s,watch:!1});if(n.value==="success"){const y=a.value;p().add({title:"Success",color:"green",description:y.message}),E("updated"),V.value=!1;return}n.value==="error"&&p().add({title:"Error",description:(i=d.value)==null?void 0:i.message,color:"red"})}},R=async()=>{var i,n,d;if(await((i=F.value)==null?void 0:i.validate(void 0,{silent:!0}))===!1)return;const{status:t,error:o,data:_}=await U("/source-drivers/test",{method:"post",body:s,watch:!1});if(t.value==="success"){const a=_.value;p().add({title:"Success",color:"green",description:a.message});return}if(t.value==="error"&&[400,422,500].includes(((n=o.value)==null?void 0:n.statusCode)||0)){const a=(d=o.value)==null?void 0:d.data;p().add({title:"Error",description:a==null?void 0:a.error,color:"red"})}};return(t,o)=>{const _=te,i=oe,n=de,d=X,a=se,y=ae,A=re;return c(),D(A,{modelValue:V.value,"onUpdate:modelValue":o[3]||(o[3]=f=>V.value=f),class:"overflow-y-auto",onKeydown:W(S(N,["ctrl","prevent"]),["enter"])},{default:u(()=>[v(y,{class:"flex flex-col flex-1",state:e(s),schema:e(O),onSubmit:S(N,["prevent"]),ref_key:"formEl",ref:F},{default:u(()=>[v(a,{class:"flex flex-col flex-1",ui:{body:{base:"flex-1"},rounded:""}},{header:u(()=>{var f,b;return[h("h2",le,C({create:"New source",edit:`Edit source n°${(f=t.source)==null?void 0:f.id}`,read:`Source n° ${(b=t.source)==null?void 0:b.id}`}[t.mode]),1)]}),footer:u(()=>[h("div",ve,[v(d,{type:"button",onClick:S(R,["prevent"]),variant:"soft",color:"sky"},{default:u(()=>o[4]||(o[4]=[j(" Test configuration ")])),_:1}),t.mode!=="read"?(c(),D(d,{key:0,type:"submit",class:"ml-auto"},{default:u(()=>[j(C({create:"Create",edit:"Save changes"}[t.mode]),1)]),_:1})):x("",!0)])]),default:u(()=>{var f,b,T,$;return[h("fieldset",{disabled:t.mode==="read",class:"grid gap-y-4"},[v(_,{name:"driver",label:"Driver",required:"",options:Object.values(e(m)||{}).map(r=>({value:r.config.ID,item:r})),modelValue:e(s).driver,"onUpdate:modelValue":o[0]||(o[0]=r=>e(s).driver=r)},{default:u(({item:r})=>[r.config.image?(c(),w("span",{key:0,innerHTML:r.config.image,class:"nested-svg"},null,8,ce)):x("",!0),h("span",{textContent:C(r.config.name)},null,8,ue)]),_:1},8,["options","modelValue"]),e(m)&&e(s).driver?(c(),w(q,{key:0},[((($=(T=(b=(f=e(m))==null?void 0:f[e(s).driver])==null?void 0:b.config)==null?void 0:T.notes)==null?void 0:$.length)||0)>0?(c(),w("div",me,[v(i,{label:"Driver Notes"}),h("ul",fe,[(c(!0),w(q,null,J(e(m)[e(s).driver].config.notes,r=>(c(),w("li",{textContent:C(r)},null,8,_e))),256))])])):x("",!0),v(i,{label:"Driver Configuration"}),e(m)&&e(s).driver?(c(),D(n,{key:1,modelValue:e(s).config,"onUpdate:modelValue":o[1]||(o[1]=r=>e(s).config=r),schema:e(g),"onUpdate:schema":o[2]||(o[2]=r=>Q(g)?g.value=r:null),fields:e(m)[e(s).driver].fields},null,8,["modelValue","schema","fields"])):x("",!0)],64)):x("",!0)],8,ie)]}),_:1})]),_:1},8,["state","schema"])]),_:1},8,["modelValue","onKeydown"])}}}),xe=ee(pe,[["__scopeId","data-v-87bef139"]]),we=()=>z("sources","/sources");export{xe as _,we as u};
