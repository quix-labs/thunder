import{g as j,h as S,i as L,O as A,r as N,H as T,p as D,k as M,o as u,x as w,w as s,q as a,aI as q,B as y,y as b,b as v,aJ as G,aK as H,v as k,aL as J,z as I,aM as K,c as U,aN as Q,d as R,t as P,aO as X,aP as Y,ah as z,aQ as W,aR as Z,aS as ee,D as ae,ae as te,b0 as oe,ai as se,b1 as le,am as re,aj as O,b2 as ne}from"./qalhANWl.js";import{f as ie,u as ce,b as ue}from"./B0QJG_uK.js";import{_ as de}from"./BugU4q1F.js";const pe={slots:{overlay:"fixed inset-0 bg-[var(--ui-bg-elevated)]/75",content:"fixed w-full h-dvh bg-[var(--ui-bg)] divide-y divide-[var(--ui-border)] flex flex-col focus:outline-none",header:"px-4 py-5 sm:px-6",body:"flex-1 p-4 sm:p-6",footer:"flex items-center gap-1.5 p-4 sm:px-6",title:"text-[var(--ui-text-highlighted)] font-semibold",description:"mt-1 text-[var(--ui-text-muted)] text-sm",close:"absolute top-4 right-4"},variants:{transition:{true:{overlay:"data-[state=open]:animate-[fade-in_200ms_ease-out] data-[state=closed]:animate-[fade-out_200ms_ease-in]",content:"data-[state=open]:animate-[scale-in_200ms_ease-out] data-[state=closed]:animate-[scale-out_200ms_ease-in]"}},fullscreen:{true:{content:"inset-0"},false:{content:"top-[50%] left-[50%] translate-x-[-50%] translate-y-[-50%] sm:max-w-lg sm:h-auto sm:my-8 sm:rounded-[calc(var(--ui-radius)*2)] sm:shadow-lg sm:ring ring-[var(--ui-border)]"}}}},me=ae;var E;const fe=j({extend:j(pe),...((E=me.ui)==null?void 0:E.modal)||{}}),ve=S({__name:"Modal",props:{title:{},description:{},content:{},overlay:{type:Boolean,default:!0},transition:{type:Boolean,default:!0},fullscreen:{type:Boolean},portal:{type:Boolean,default:!0},close:{type:Boolean,default:!0},closeIcon:{},preventClose:{type:Boolean},class:{},ui:{},open:{type:Boolean},defaultOpen:{type:Boolean},modal:{type:Boolean,default:!0}},emits:["update:open"],setup($,{emit:h}){const t=$,B=h,l=L(),V=A(N(t,"open","defaultOpen","modal"),B),x=T(()=>t.content),d=D(()=>t.preventClose?{pointerDownOutside:e=>e.preventDefault(),interactOutside:e=>e.preventDefault()}:{}),C=M(),r=D(()=>fe({transition:t.transition,fullscreen:t.fullscreen}));return(e,n)=>(u(),w(a(ee),W(Z(a(V))),{default:s(({open:i})=>[l.default?(u(),w(a(q),{key:0,"as-child":""},{default:s(()=>[y(e.$slots,"default",{open:i})]),_:2},1024)):b("",!0),v(a(G),{disabled:!e.portal},{default:s(()=>{var p,_;return[e.overlay?(u(),w(a(H),{key:0,class:k(r.value.overlay({class:(p=t.ui)==null?void 0:p.overlay}))},null,8,["class"])):b("",!0),v(a(J),I({class:r.value.content({class:[t.class,(_=t.ui)==null?void 0:_.content]})},x.value,K(d.value)),{default:s(()=>[y(e.$slots,"content",{},()=>{var g,c,m;return[l.header||e.title||l.title||e.description||l.description||e.close||l.close?(u(),U("div",{key:0,class:k(r.value.header({class:(g=t.ui)==null?void 0:g.header}))},[y(e.$slots,"header",{},()=>{var o,f;return[e.title||l.title?(u(),w(a(Q),{key:0,class:k(r.value.title({class:(o=t.ui)==null?void 0:o.title}))},{default:s(()=>[y(e.$slots,"title",{},()=>[R(P(e.title),1)])]),_:3},8,["class"])):b("",!0),e.description||l.description?(u(),w(a(X),{key:1,class:k(r.value.description({class:(f=t.ui)==null?void 0:f.description}))},{default:s(()=>[y(e.$slots,"description",{},()=>[R(P(e.description),1)])]),_:3},8,["class"])):b("",!0),v(a(Y),{"as-child":""},{default:s(()=>[y(e.$slots,"close",{ui:r.value},()=>{var F;return[e.close?(u(),w(z,I({key:0,icon:e.closeIcon||a(C).ui.icons.close,size:"md",color:"neutral",variant:"ghost","aria-label":"Close"},typeof e.close=="object"?e.close:void 0,{class:r.value.close({class:(F=t.ui)==null?void 0:F.close})}),null,16,["icon","class"])):b("",!0)]})]),_:3})]})],2)):b("",!0),l.body?(u(),U("div",{key:1,class:k(r.value.body({class:(c=t.ui)==null?void 0:c.body}))},[y(e.$slots,"body")],2)):b("",!0),l.footer?(u(),U("div",{key:2,class:k(r.value.footer({class:(m=t.ui)==null?void 0:m.footer}))},[y(e.$slots,"footer")],2)):b("",!0)]})]),_:3},16,["class"])]}),_:3},8,["disabled"])]),_:3},16))}}),ye=$=>te("exporters","/exporters",void 0,$),we=S({__name:"DownloadProcessorForm",props:{processorId:{}},async setup($){var e;let h,t;const{data:B,status:l,error:V}=([h,t]=oe(()=>ye({lazy:!1})),h=await h,t(),h),x=$,d=se({exporter:l.value==="success"&&B.value?(e=Object.keys(B.value))==null?void 0:e.at(0):null,filename:null}),C=D(()=>{var n;return`processor-${x.processorId}.${(n=d.exporter)==null?void 0:n.replace("thunder.","")}`}),r=async()=>{var g;const n={...le(d)};n.filename||(n.filename=C.value);const{data:i,error:p,status:_}=await ce(`processors/${x.processorId}/download`,{params:n,responseType:"blob"});if((g=re())==null||g.close(),_.value==="success"&&i.value){const c=()=>{const m=window.URL.createObjectURL(i.value),o=document.createElement("a");o.href=m,o.download=n.filename,o.click(),setTimeout(()=>{window.URL.revokeObjectURL(m)},0)};c(),O().add({color:"success",title:"File Ready for Download",close:!1,actions:[{icon:"i-heroicons-arrow-down-tray",label:"Download file",color:"primary",variant:"outline",onClick:c}]})}else if(p.value)if(p.value.data instanceof Blob){const c=new FileReader;c.onload=m=>{var o;try{const f=JSON.parse(((o=m.target)==null?void 0:o.result)||"null");O().add({title:"Failed to generate file",description:f.error||"An unknown error occurred.",color:"error"})}catch{O().add({title:"Failed to generate file",description:"Error parsing the error response.",color:"error"})}},c.readAsText(p.value.data)}else O().add({title:"Failed to generate file",description:p.value.message,color:"error"})};return(n,i)=>{const p=ne,_=ue,g=de,c=z,m=ve;return u(),w(m,{title:`Download data for processor nÂ°${n.processorId}`},{body:s(()=>[v(a(ie),{state:a(d),onSubmit:r,class:"space-y-4"},{default:s(()=>[v(_,{label:"Exporter",name:"exporter",required:""},{default:s(()=>{var o;return[v(p,{modelValue:a(d).exporter,"onUpdate:modelValue":i[0]||(i[0]=f=>a(d).exporter=f),items:(o=Object.entries(a(B)||{}))==null?void 0:o.map(([f,F])=>({label:F,value:f,description:"test"})),required:""},null,8,["modelValue","items"])]}),_:1}),v(_,{label:"Filename",name:"filename"},{default:s(()=>[v(g,{placeholder:a(C),modelValue:a(d).filename,"onUpdate:modelValue":i[1]||(i[1]=o=>a(d).filename=o)},null,8,["placeholder","modelValue"])]),_:1}),v(c,{type:"submit",class:"p-3 cursor-pointer",block:"","loading-auto":""},{default:s(()=>i[2]||(i[2]=[R(" Generate file ")])),_:1})]),_:1},8,["state"])]),_:1},8,["title"])}}});export{we as default};
